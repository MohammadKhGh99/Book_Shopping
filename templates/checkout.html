<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Checkout</title>
</head>

<style>
  #checkout-container {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
  }

  #checkout-container form {
    text-align: right;
    width: 350px;
    color: #525d85;
  }

  .input_field {
    width: 100%;
    height: 50px;
    line-height: 50px;
    border: 1px solid rgba(12, 27, 84, .5);
    font-family: "Traditional Arabic", serif;
    font-size: 0.9em;
    padding-right: 10px;
  }

  #lower-checkout {
    display: flex;
    justify-content: space-between;
    align-items: center;
    /*column-gap: 10px;*/
    margin: 20px 0 20px 0;
  }

  #checkout-button {
    /*width: 100%;*/
    background-color: #cce5ff;
    font-family: "Traditional Arabic",serif;
    border: 0;
    cursor: pointer;
    margin-right: 2px;
  }

  #checkout-button:hover {
    background-color: #e5e5e5;
  }

</style>

<body>
  {% extends "base.html" %}

  {% block no_search %}hidden{% endblock %}

  {% block lower_container %}
  <div id="checkout-container">
    <h3>
      الرجاء إدخال معلومات الشحن الخاصة بك
    </h3>
    <form method="post">
      <div class="field-holder" >
        <label for="customer-first-name" class="input_label">الاسم الأول</label><br>
        <input type="text" id="customer-first-name" class="input_field" name="customer-first-name" autocomplete="given-name" required>
      </div>
      <div class="field-holder" >
        <label for="customer-last-name" class="input_label">اسم العائلة</label><br>
        <input type="text" id="customer-last-name" class="input_field" name="customer-last-name" autocomplete="family-name" required>
      </div>
      <div class="field-holder">
        <label for="customer-city" class="input_label">البلد</label><br>
        <select id="customer-city" class="input_field" name="customer-city" required style="width: 365px; background-color: white" onchange="AddShipping()">
          <option value="اختر مدينة">اختر مدينة</option>
          {% for city in cities %}
            <option value="{{city}}">{{city}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="field-holder" >
        <label for="customer-address" class="input_label">العنوان</label><br>
        <input type="text" id="customer-address" class="input_field" name="customer-address" autocomplete="address" required>
      </div>
      <div class="field-holder">
        <label for="customer-email" class="input_label">البريد الإلكتروني</label>
        <input type="email" id="customer-email" class="input_field" name="customer-email" autocomplete="email" required>
      </div>
      <div class="field-holder">
        <label for="customer-phone" class="input_label">رقم الهاتف الشخصي</label>
        <input type="tel" id="customer-phone" class="input_field" name="customer-phone" autocomplete="phone" required style="text-align: right" maxlength="10">
      </div>
      <div class="field-holder" >
        <label for="customer-backup-phone" class="input_label">رقم هاتف إحتياطي</label><br>
        <input type="tel" id="customer-backup-phone" class="input_field" name="customer-backup-phone" autocomplete="phone" style="text-align: right" maxlength="10">
      </div>
      <div id="lower-checkout">
        <span>
          المجموع الكلي:
          <b>{{total}}</b> ₪
          <span style="font-size: 0.6em">
            ({{total}} +
            <b>0</b>
            رسوم شحن)
          </span>
        </span>
        <button type="submit" id="checkout-button">
          تأكيد الطلب
        </button>
      </div>
    </form>
  </div>
  {% if cur_user %}
    <script>
      document.getElementById("customer-first-name").value = "{{cur_user.first_name}}";
      document.getElementById("customer-last-name").value = "{{cur_user.last_name}}";
      document.getElementById("customer-phone").value = "{{cur_user.phone_number}}";
      document.getElementById("customer-address").value = "{{cur_user.address}}";
      document.getElementById("customer-backup-phone").value = "{{cur_user.backup_phone}}" === "None" ? "" : "{{cur_user.backup_phone}}";
      document.getElementById("customer-email").value = "{{cur_user.email}}";
      let citiesParent = document.getElementById("customer-city");
      const all_cities = citiesParent.children;
      for (let i = 0; i < all_cities.length; i++) {
          if (all_cities[i].value.includes("{{cur_user.city}}")) {
              citiesParent.selectedIndex = i;
              break;
          }
      }

    </script>
  {% endif %}
  <script>
      const totalPriceSpan = document.querySelector("#lower-checkout").children[0];
      const totalPriceB = totalPriceSpan.querySelector("b");
      const shippingSpan = totalPriceSpan.querySelector("span");
      const shippingB = shippingSpan.querySelector("b");
      const cityInput = document.getElementById("customer-city");
      if (cityInput.value !== "اختر مدينة") {
          AddShipping();
      }

      function AddShipping() {
          let newTotal = parseInt("{{total}}") + 25;
          totalPriceB.textContent = newTotal.toString();
          // TODO - shipping value for each city
          let newShippingValue = parseInt(shippingB.textContent);
          newShippingValue = 25;
          shippingB.textContent = newShippingValue.toString();
          // shippingSpan.style.display = "block";
      }
  </script>
  {% endblock %}

</body>
</html>