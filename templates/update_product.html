<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>تعديل منتج</title>
</head>

<style>

  form {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    padding-right: 0;
    padding-bottom: 40px;
    font-size: 1.2em;
    /*width: 300px;*/
  }

  @media (max-width: 767px) {
    form div {
      width: 80vw;
    }
  }

  @media (min-width: 767px) {
    form div {
      width: 50vw;
    }
  }

  .input-field {
    /*font-size: 0.9em;*/
    width: 100%;
    padding-right: 10px;
    height: 50px;
    line-height: 50px;
    border: 1px solid rgba(12, 27, 84, .5);
    font-family: "Traditional Arabic", serif;
    font-size: 0.8em;
  }

  /*.field-holder {*/
  /*  margin-bottom: 10px;*/
  /*}*/

  .field-holder {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    flex-direction: column;
  }

  #product-description {
    height: 100px;
  }

  #go-new-added-button, #save-product-button {
    font-size: 1em;
    font-family: 'Traditional Arabic', sans-serif;
    text-decoration: none;
    background-color: #cce5ff;
    cursor: pointer;
    border: 0;
    padding: 5px 5px 5px 5px;
  }

  #go-new-added-button {
    text-decoration: none;
    margin: 30px 40vw 30px 0;
  }

  #go-new-added-button a{
    text-decoration: none;
    color: black;
    transition-duration: 0.5s;
  }

  #go-new-added-button:hover, #save-product-button:hover {
    background-color: #e5e5e5;
  }

  .img-holder {
    position: relative;
  }

  .image-delete {
    position: absolute;
    top: 0;
    right: 0;
    cursor: pointer;
  }

  .image-delete:hover {
    color: #cce5ff;
  }

  #add-image-button {
    background-color: #cce5ff;
    cursor: pointer;
    border: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 10px;
    padding: 10px;
    transition-duration: 0.5s;
  }

  #add-image-button:hover {
    background-color: #e5e5e5;
  }

  #type-price-quantity {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
  }

</style>

<body>

  {% extends "admin_profile.html" %}

  {% block users_count %}
  {% endblock %}

  {% block lower_container %}
  <div id="updating-products-container">
  {% if not done_updating %}
    <form method="post" enctype="multipart/form-data" id="update-form">
      <h4 id="add-title">تعديل منتج رقم {{result[0]}}</h4>
      <div id="form-container">
        <input id="product-id-input" name="product-id-input" style="display: none" type="number" value="{{result[0]}}">
        <div class="field-holder">
          <label for="product-name">إسم المنتج</label>
          <input value="{{result[1]}}" type="text" id="product-name" name="product-name" class="input-field">
        </div>
        <div id="type-price-quantity">
          <div class="field-holder" style="align-items: center;">
            <label for="product-type">نوع المنتج</label>
            <select id="product-type" name="product-type" class="input-field" style="width: 150px;">
              {% for type in types %}
               <option value="{{type}}">{{type}}</option>
              {% endfor %}
            </select>
          </div>
          <div class="field-holder" style="align-items: center;">
            <label for="product-price">السعر</label>
            <input value="{{result[4]}}" type="text" id="product-price" name="product-price" class="input-field" style="width: 80px">
          </div>
          <div class="field-holder" style="align-items: center;">
            <label for="product-items-left">الكمية</label>
            <input value="{{result[5]}}" type="number" id="product-items-left" name="product-items-left" class="input-field" style="width: 80px">
          </div>
        </div>

        <script>
            const productType = document.getElementById("product-type");
            const realType = "{{result[2]}}";
            for (let i = 0; i < productType.children.length; i++) {
                if (productType.children[i].value === realType) {
                    productType.children[i].setAttribute("selected", "true");
                }
            }
        </script>
        <div class="field-holder">
          <span>صور المنتج</span>
          <br>
          {% for image in images %}
            <div class="img-holder">
              <span class="material-symbols-outlined image-delete" onclick="DeleteImage(this)">
                delete
              </span>
              <img src="{{url_for('static', filename=image)}}" alt="img"><br>
            </div>
          {% endfor %}
          <!-- <input type="file" accept="image/*" multiple id="product-img1" name="product-img1" class="input-field"> -->
          <button type="button" id="add-image-button" onclick="AddImage(this)">
            إضافة صورة
          </button>
        </div>
        <script>
          const imagesStr = "{{images}}";
          let imgCounter = imagesStr.match(new RegExp(",", "g")).length + 1;
          function AddImage(button) {
              if (imgCounter < 5) {
                imgCounter++;
                // adding label
                const newLabel = document.createElement("label");
                newLabel.setAttribute("for", "product-img" + imgCounter.toString());
                newLabel.textContent = "صورة";
                button.parentNode.insertBefore(newLabel, button);

                // adding input field
                const newInput = document.createElement("input");
                newInput.classList.add("input-field");
                newInput.setAttribute("id", "product-img" + imgCounter.toString());
                newInput.setAttribute("name", "product-img" + imgCounter.toString());
                newInput.setAttribute("type", "file");
                newInput.setAttribute("accept", "image/*");
                
                button.parentNode.insertBefore(newInput, button);
               } else {
                window.alert("يمكنك إضافة حتى 5 صور للمنتج!")
              }
          }
        </script>
        <div class="field-holder">
          <label for="product-description">وصف المنتج</label>
          <textarea id="product-description" name="product-description" class="input-field">{{result[6]}}</textarea>
<!--          <input type="text" id="product-description" name="product-description" class="input-field" height="20">-->
        </div>
        
        <!-- <div class="field-holder">
          <label for="product-publish-year">سنة الإصدار</label><br>
          <input value="{{result[7]}}" type="text" id="product-publish-year" name="product-publish-year" class="input-field">
        </div>
        <div class="field-holder">
          <label for="product-author">المؤلف</label><br>
          <input value="{{result[8]}}" type="text" id="product-author" name="product-author" class="input-field">
        </div>
        <div class="field-holder">
          <label for="product-categories">تصنيفات</label><br>
          <select id="product-tags" name="product-tags" class="input-field" style="width: 363px">
          <input value="{{result[9]}}" type="text" id="product-categories" name="product-categories" class="input-field">
        </div> -->
        <br>
        <button type="submit" id="save-product-button">
          حفظ المنتج
        </button>
      </div>
    </form>
    <form method="post" id="delete-img-form">
      <input type="hidden" id="delete-img" name="delete-img">
    </form>
    <script>
        function DeleteImage(span) {
            document.getElementById("delete-img").value = "{{result[0]}}," + span.parentNode.children[1].src;
            console.log(document.getElementById("delete-img-form"));
            document.getElementById("delete-img-form").submit();
        }
    </script>
  {% endif %}
  {% if done_updating %}
    <button id="go-new-added-button">
      <a href="{{url_for('product', id_num=id_num, ptype=ptype)}}">
        الإنتقال للمنتج المُعدّل حديثًا
      </a>
    </button>
  {% endif %}
  </div>
  {% endblock %}
</body>
</html>