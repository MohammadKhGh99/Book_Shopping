<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Orders</title>
</head>

<style>
  #orders-container {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    padding: 20px 20px 20px 20px;
  }

  #all-orders-table {
    /*border: 1px solid black;*/
    border-collapse: collapse;
    font-size: 1em;
  }

  /*.order-id-td, .order-total-td, .order-status-td {*/
  /*  width: 10%;*/
  /*  max-width: 10%;*/
  /*}*/

  .order-id-td, .order-total-td, .order-status-td {
    vertical-align: top;
    text-align: center;
    /*padding: 0;*/
    padding: 10px 0 0 0;
  }

  .order-customer-info div{
    display: flex;
    justify-content: center;
    align-items: flex-start;
    flex-direction: column;
    font-size: 0.7em;
    margin-right: 5px;
  }

  .order-status-td div {
    width: 90%;
    display: inline-block;
  }

  .order-content {
    /*height: 20vh;*/
    padding: 0;
    /*max-height: 20%;*/
  }

  .order-content table tr:not(:first-child) {
    height: 100px;

  }

  table, th, td {
    border: 1px solid black;
    border-collapse: collapse;
    font-size: 1em;
  }

  table {
    width: 100%;
    /*margin-bottom: 50px;*/
  }

  td {
    /*display: flex;*/
    /*border: 0;*/
    /*justify-content: center;*/
    /*width: 100%;*/
    text-align: center;
    vertical-align: middle;
    padding: 10px 0 10px 0;
  }

  .each-order-table {
    font-size: 0.8em;
  }

  .each-order-table td a {
    width: 100%;
    height: 100%;
    /*max-width: 90%;*/
    /*max-height: 90%;*/
    display: flex;
    justify-content: center;
    align-items: center;
    /*margin: 13px 0 0 0;*/
    padding: 0;
  }

  td img {
    width: 100%;
    height: 100%;
  /*  padding: 0;*/
  }

</style>

<body>

  {% extends "admin_profile.html" %}

  {% block lower_container %}
  <div id="orders-container">
    <h2>الطلبات</h2>
    <table id="all-orders-table">
      <tr>
        <th style="width: 8%;">رقم الطلب</th>
        <th style="width: 20%;">معلومات الزبون</th>
        <th>محتوى الطلب</th>
        <th style="width: 10%;">السعر الكلي</th>
        <th style="width: 15%;">حالة الطلب</th>
      </tr>
      {% for order in all_orders %}
      <script>
        let orderTotal = 0;
      </script>
      <tr>
        <td class="order-id-td">{{order[0]}}</td>
        <td class="order-customer-info" style="vertical-align: top;">
          <div>
            <span id="order-customer-fullname">
              إسم الزبون:
              {{order[3]}} {{order[4]}}
            </span>
  <!--          <span id="order-customer-role">-->
  <!--            {{order[5]}}-->
  <!--          </span>-->
            <span id="order-customer-city">
              البلد:
              {{order[6]}}
            </span>
            <span id="order-customer-address">
              العنوان:
              {{order[7]}}
            </span>
            <span id="order-customer-email">
              إيميل:
              {{order[8]}}
            </span>
            <span id="order-customer-phone-number">
              رقم الهاتف الشخصي:
              {{order[10]}}
            </span>
            <span id="order-customer-backup-phone">
              هاتف إحتياطي:
              {% if order[9] == "" %}
                  -
              {% else %}
                {{order[9]}}
              {% endif %}
            </span>
            <span id="order-customer-order-date">
              تاريخ الطلب:
              {{order[11]}}
            </span>
          </div>

        </td>
        <td class="order-content">
          <table class="each-order-table">
            <tr>
              <th style="width: 10%">رقم المنتج</th>
              <th style="width: 20%">صورة المنتج</th>
              <th>إسم المنتج</th>
              <th style="width: 15%">السعر</th>
              <th style="width: 10%">الكمية</th>
            </tr>
            {% for id_num, (quantity, item) in order[-1].items() %}
            <tr>
              <td style="vertical-align: top; text-decoration: Highlight">
                {{item[0]}}
              </td>
              <td>
                <a href="{{url_for('product', name=item[1], ptype=item[2], id_num=item[0])}}">
                  <img src="../{{item[3]}}" alt="item">
                </a>
              </td>
              <td style="vertical-align: top">
                {{item[1]}}
              </td>
              <td style="vertical-align: top">
                {{item[4]}} ₪
              </td>
              <td style="vertical-align: top">
                {{quantity}}
              </td>
            </tr>
            <script>
              orderTotal += parseInt("{{quantity}}") * parseFloat("{{item[4]}}");
            </script>
            {% endfor %}
          </table>
        </td>
        <td class="order-total-td">
          {{order[-3]}} ₪
<!--          <script>-->
<!--            document.currentScript.parentNode.textContent = orderTotal.toString();-->
<!--          </script>-->
        </td>
        <td class="order-status-td">
          <div id="status-container">
            <select disabled>
              <option value="تم التأكيد">
                تم التأكيد
              </option>
              <option value="تم التجهيز">
                تم التجهيز
              </option>
              <option value="الطلب في الطريق">
                الطلب في الطريق
              </option>
              <option value="تم التوصيل">
                تم التوصيل
              </option>
              <script>
                  selectNode = document.currentScript.parentNode;
                  for (let i = 0; i < selectNode.children.length; i++) {
                      if (selectNode.children[i].value === "{{order[-2]}}") {
                          selectNode.selectedIndex = i;
                      }
                  }
              </script>
            </select>
            <button onclick="UpdateStatus(this)">
              تعديل الحالة
            </button>
          </div>
        </td>
      </tr>
      {% endfor %}
    </table>
    <script>
        function UpdateStatus(button) {
            const selectNode = button.parentNode.children[0];
            selectNode.removeAttribute("disabled");
        }
    </script>
  </div>
  {% endblock %}

</body>
</html>