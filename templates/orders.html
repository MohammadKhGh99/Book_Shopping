<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Orders</title>
</head>

<style>
    #orders-container {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    padding: 20px 20px 20px 20px;
    max-width: 100%;
  }

  #all-orders-table {
    border-collapse: collapse;
    font-size: 0.9em;
    max-width: 100%;
    width: 100%;
    margin-bottom: 50px;
  }

  #all-orders-table tr th {
    border: 1px solid black;
    border-collapse: collapse;
  }

  .order-id-td, .order-total-td, .order-status-td, .order-number {
    vertical-align: top;
    text-align: center;
    padding: 10px 0 0 0;
  }

  .order-customer-info div{
    display: flex;
    justify-content: center;
    align-items: flex-start;
    flex-direction: column;
    font-size: 0.9em;
    margin-right: 5px;
  }

  .order-status-td p {
    width: 90%;
    display: inline-block;
    font-size: 0.9em;
    border: 1px solid black;
  }

  .order-content {
    padding: 0;
  }

  .each-order-table{
    border: 1px solid black;
    border-collapse: collapse;
    font-size: 0.8em;
    width: 100%;
    height: 100%;
    min-height: 100%;
  }

  td {
    text-align: center;
    vertical-align: middle;
    padding: 10px 0 10px 0;
    border: 1px solid black;
    border-collapse: collapse;
  }

  .each-order-table td a {
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0;
  }

  td img {
    width: 100%;
    height: 100%;
  }

</style>

<body>
  {% extends "profile.html" %}

  {% block lower_container %}
  <div id="orders-container">
    <h2>الطلبات الخاصة بك</h2>
    <table id="all-orders-table">
      <script>
        let orderTotal = 0;
        let totalNoShip = "";
      </script>
      <tr>
        <th style="width: 3%">#</th>
        <th style="width: 8%;">رقم الطلب</th>
        <th style="width: 20%;">معلومات الزبون</th>
        <th>محتوى الطلب</th>
        <th style="width: 10%;">المجموع الكلي</th>
        <th style="width: 15%;">حالة الطلب</th>
      </tr>
      {% for order in all_orders %}
      <script>
        orderTotal = 0;
      </script>
      <tr>
        <td class="order-number">#{{loop.index}}</td>
        <td class="order-id-td">{{order[0]}}</td>
        <td class="order-customer-info" style="vertical-align: top;">
          <div>
            <span id="order-customer-fullname">
              إسم الزبون:
              {{order[3]}} {{order[4]}}
            </span>
  <!--          <span id="order-customer-role">-->
  <!--            {{order[5]}}-->
  <!--          </span>-->
            <span id="order-customer-city">
              البلد:
              {{order[6]}}
            </span>
            <span id="order-customer-address">
              العنوان:
              {{order[7]}}
            </span>
            <span id="order-customer-email">
              إيميل:
              {{order[8]}}
            </span>
            <span id="order-customer-phone-number">
              رقم الهاتف الشخصي:
              {{order[10]}}
            </span>
            <span id="order-customer-backup-phone">
              رقم هاتف إحتياطي:
              {% if order[9] == "" %}
                  -
              {% else %}
                {{order[9]}}
              {% endif %}
            </span>
            <span id="order-customer-order-date">
              تاريخ الطلب:
              {{order[11]}}
            </span>
          </div>
        </td>
        <td class="order-content">
          <table class="each-order-table">
            <tr>
              <th style="width: 10%">رقم المنتج</th>
              <th style="width: 20%">صورة المنتج</th>
              <th>إسم المنتج</th>
              <th style="width: 15%">السعر</th>
              <th style="width: 10%">الكمية</th>
            </tr>
            {% for id_num, (quantity, item) in order[-2].items() %}
            <tr>
              <td style="vertical-align: top; text-decoration: Highlight">
                {{item[0]}}
              </td>
              <td>
                <a href="{{url_for('product', name=item[1], ptype=item[2], id_num=item[0])}}">
                  {% if item[3].find(',') != -1 %}
                    <img src="{{url_for('static', filename=item[3][:item[3].index(',')][7:])}}" alt="item">
                  {% else %}
                    <img src="{{url_for('static', filename=item[3][7:])}}" alt="item">
                  {% endif %}
                </a>
              </td>
              <td style="vertical-align: top">
                {{item[1]}}
              </td>
              <td style="vertical-align: top">
                {{item[4]}} ₪
              </td>
              <td style="vertical-align: top">
                {{quantity}}
              </td>
            </tr>
            <script>
              orderTotal += parseInt("{{quantity}}") * parseFloat("{{item[4]}}");
            </script>
            {% endfor %}
          </table>

        </td>
        <td class="order-total-td" style="font-size: 0.8em; padding-bottom: 20px">
          <span id="subtotal">
            مجموع جزئي:
            <b>{{order[-4]}}</b> ₪
            <br>
            <script>
                totalNoShip = parseFloat("{{order[-4]}}") - parseFloat("{{order[-1]}}");
                document.currentScript.parentNode.children[0].textContent = totalNoShip.toString();
            </script>
          </span>
          <span id="shipping-fee" style="border-bottom: 1px solid black;">
            رسوم شحن:
            <b>{{order[-1]}}</b> ₪
          </span>
          <br><br>
          <b>
            مجموع الطلب: {{order[-4]}} ₪
          </b>
        </td>
        <td class="order-status-td">
          <p>{{order[-3]}}</p>
        </td>
      </tr>
      {% endfor %}
    </table>
  </div>
  {% endblock %}


</body>
</html>